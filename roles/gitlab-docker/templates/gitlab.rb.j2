external_url '{{gitlab_external_url}}'

### Necessary to run gitlab behind a reverse proxy
nginx['listen_port'] = 80
nginx['listen_https'] = false

### LDAP Settings
###! Docs: https://docs.gitlab.com/omnibus/settings/ldap.html
###! **Be careful not to break the indentation in the ldap_servers block. It is
###!   in yaml format and the spaces must be retained. Using tabs will not work.**

gitlab_rails['ldap_enabled'] = true
gitlab_rails['prevent_ldap_sign_in'] = false

###! **remember to close this block with 'EOS' below**
gitlab_rails['ldap_servers'] = YAML.load <<-'EOS'
  main: # 'main' is the GitLab 'provider ID' of this LDAP server
    label: 'LDAP'
    host: '{{gitlab_ldap_host}}'
    port: {{gitlab_ldap_port}}
    uid: '{{gitlab_ldap_username_attribute}}'
    bind_dn: '{{gitlab_ldap_bind_dn}}'
    password: '{{gitlab_ldap_bind_dn_password}}'
    encryption: '{{gitlab_ldap_encryption}}'
    verify_certificates: {{gitlab_ldap_verify_certificates}}
    base: '{{gitlab_ldap_base_dn}}'
EOS

gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "{{gitlab_smtp_server}}"
gitlab_rails['smtp_port'] = {{gitlab_smtp_port}}
gitlab_rails['smtp_user_name'] = "{{gitlab_smtp_username}}"
gitlab_rails['smtp_password'] = "{{gitlab_smtp_password}}"
gitlab_rails['smtp_domain'] = "{{gitlab_smtp_domain}}"
gitlab_rails['smtp_authentication'] = "login"
gitlab_rails['smtp_enable_starttls_auto'] = true
gitlab_rails['smtp_tls'] = true
gitlab_rails['smtp_openssl_verify_mode'] = 'none'
gitlab_rails['gitlab_email_from'] = '{{gitlab_smtp_sender_address}}'